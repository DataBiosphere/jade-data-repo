apiVersion: v1
kind: Pod
metadata:
  name: data-repo-api
  namespace: data-repo
  labels:
    app: data-repo
    component: data-repo-api
spec:
  volumes:
  - name: google-cloud-key
    secret:
      secretName: sa-key
  containers:
  - name: data-repo-api-container
    image: gcr.io/broad-jade-dev/jade-data-repo:latest
    volumeMounts:
    - name: google-cloud-key
      mountPath: /var/secrets/google
    ports:
    - containerPort: 8080
    - containerPort: 5005
    env:
    - name: GOOGLE_APPLICATION_CREDENTIALS
      value: /var/secrets/google/sa-key.json
    - name: OAUTH_CLIENT_ID
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: oauth-client-id
    - name: GOOGLE_CLOUD_PROJECT
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: google-cloud-project
    - name: DB_DATAREPO_URI
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: datarepo-uri
    - name: DB_DATAREPO_USERNAME
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: datarepo-username
    - name: DB_DATAREPO_PASSWORD
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: datarepo-password
    - name: DB_STAIRWAY_URI
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: stairway-uri
    - name: DB_STAIRWAY_USERNAME
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: stairway-username
    - name: DB_STAIRWAY_PASSWORD
      valueFrom:
        secretKeyRef:
          name: api-secrets
          key: stairway-password
